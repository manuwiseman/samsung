recent highlights

1. input/soft keyboard AR browser

#Situation:  
We are developing a cutting-edge AR platform web browser based on unity, our team is providing web-engine part, and there is a UI team developing UI part in Unity(mainly C#), our team mostly focus on providing the web engine service. we also have microsoft as our partner to provide us lower level ARDK support(called CoreXP), recently we are trying to add milestone feature that supports soft keyboard in AR browser, as part of bigger concept "phone as controller", whenever user put cursor in the input box(e.g. google search box) in the browser, the soft keyboard should show on mobile screen. It's a quite important sicne input is one of the main way that user ineract with our browser.

The UI team is expecting us to provide this feature in the engine side, and they have planned many features that relying on our soft keyboard in their next sprint. QA is also expecting to test this feature thoroughly before shipping, so it's really urgent for us to deliver this feature.

One of my teammates took this task in the beginning, while at that moment I also had some urgent features to deliver. I was able to deliver those features early and hence move to the next few tasks assigned to me, and those tasks are a bit less urgent. 


#Task:  
I was approached by my manager and my teammate for this soft keyboard feature, this feature and has been working fine in our mobile browser,  but not in AR browser. my teammate has been working on this issue for 2-3 weeks and was completely stuck, and we are getting closer to the deadline. Since I have solved the most urgent features assigned to me, my manager asked me if I can help debug a bit and provide some idea to move this forward since this is the most urgent feature that our team had to deliver no matter what.


#Action:  
I accepted the task immediately to help out my teammate to debug. I found mobile code and AR code did hit same part of logic in our web engine side, but for mobile browser the content view object(the view that renders the web page view in the AR Headset(HMD)) can establish an input connection with the input manager, so whenever the input box gains the focus, soft keyboard shows up, however, the same content view object can never establish an active input connection with the input mananger, so even after user put cursor into the input box and the input box has the focus(we verified this in the javascript console log), soft keyboard didn't show up. 
Same like my teammate, I was also very confused about why the contenet view in AR code doesn't have an active input connection, one difference I know between the AR browser and the mobile browser is AR obviously has a separate display i.e. the headset(HMD), and when the AR browser is launched, right now it's a 2-step procedure, 1. on the phone click the app like every other android app to launch, 2. on the phone it will show a page with blue button says "show app in HMD", and this is from microsoft coreXP, user has to click on that to show the app in HMD. That made me suspect that the input mananger might be able to establish an input connection, but just not with the content view object, so I put more logging and debug more, it turns out the view that can potentially have an active input connection is the unity surface view and that's the view that's showing that blue button "show app in HMD", it has current focus with the launcher Android activity and input connection is associate with it, and that's why even after user put the cursor in the input box in HMD, and content view gains the focus, the input connection is still between the input manager and unity surface view, so I added code in our web engine showKeyBoard() funciton, to check if we are in AR web browser, then start the input connection with the unity surface view. This is small change and we are sure it will not impact the existing logic.  

Once I tried that, the soft keyboard finally shows up successfully on the mobile phone screen. However, when I tried to type on the soft keyboard, I found that the typing is not being displayed in the input box in the HMD. My teammate then insisted that we should go back and try to somehow established the input connection with the content view instead of the unity surface view. I considered his opinion, and I realized that 1. it was the same idea that we began with and it made us stuck for weeks, the chance that we solve this in short time is very small 2. even after days or weeks we can somehow make this happen we will end up adding so much hardcode logic into our web engine code and might break the other features depending on the engine 3. we are close to deadline, we made good progress with current approach. So I then took a step back and thought through the whole workflow, the view that has the active input connection is the unity surface view, and whatever we type right now is happening only in the unity side, I then put some debugger in the unity activity class and see the dispatchKeyEvent(), onKeyDown(), onKeyUp() method was called, I then realize all we need to do is send this key event back to our web engine code, and that content view belongs to our web engine, once the web engine receives the key event, it will work just like mobile code, the content view object will receive the key event and dispaly user's input correctly. I explained my thoughts to my teammate and manager, and they liked the idea (can also say that my teammate initially doesn't like this idea and said passing the key event might cause delay, etc, then I proved him wrong, this can be an example of "how did you solve a conflict with your coworker, etc"), I write up the patch quickly, build the apk. And the soft keyboard works like a charm.

#Result:  
we were able to solve this urgent issue and deliver a few days earlier than the deadline so the QA have more time to test it, so far the feedback about this feature is very good. The UI team were very happy about our delivery since it has cleaned the roadblock for their next sprint. We have a scheduled demo meeting with the Samsung mobile CEO and Microsoft CEO in April and our timeline is very tight, and this delivery helped the team to meet milestone and unblock about half of the features we plan to deliver